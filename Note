SELECT
    schemaname,
    relname        AS table_name,
    indexrelname   AS index_name,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch,
    pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,
    pg_get_indexdef(indexrelid)                  AS index_def
FROM pg_stat_user_indexes
JOIN pg_index USING (indexrelid)
WHERE
    idx_scan < 50                      -- 使用次数阈值，自行调整
    AND pg_relation_size(indexrelid) > 8 * 1024 * 1024  -- 大于 8MB 的索引，避免关注太小的
    AND NOT indisprimary              -- 排除主键索引
    AND NOT indisunique               -- 排除 UNIQUE 索引
    AND NOT indisexclusion            -- 排除排它约束索引
ORDER BY
    idx_scan ASC,
    pg_relation_size(indexrelid) DESC;